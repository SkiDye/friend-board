# v1.6.0 - Link Preview & ESC Key

웹 UI에서 복사-붙여넣기용 파일입니다.
https://skidye.github.io/friend-board/#/dev-history 에서 "+ 새 히스토리" 클릭 후 아래 내용을 각 필드에 붙여넣으세요.

---

## 버전
v1.6.0

---

## 제목
Link Preview & ESC Key - 링크 미리보기와 ESC 키 지원

---

## 내용 (아래 전체를 복사)

🔗 **링크를 더 풍부하게! 키보드로 더 편하게!**

## 문제점
❌ URL이 텍스트로만 표시되어 클릭 전엔 내용 확인 불가
❌ 어떤 사이트인지 미리 알 수 없음
❌ 웹에서 모달을 닫으려면 닫기 버튼까지 마우스로 이동
❌ 키보드만으로 빠른 탐색 불가

## 해결책 - 링크 미리보기 카드 + ESC 키 지원

### 1️⃣ 링크 미리보기 카드
```javascript
// LinkPreview.jsx - Open Graph 메타데이터 자동 fetch
const fetchPreview = async () => {
  const response = await fetch(
    `https://api.microlink.io?url=${encodeURIComponent(url)}`
  )

  const data = await response.json()

  if (data.status === 'success') {
    setPreview({
      title: data.data.title,
      description: data.data.description,
      image: data.data.image?.url,
      url: data.data.url
    })
  }
}
```

**카드 구성 (낮은 직사각형)**
```
┌─────────────────────────────────────┐
│ [제목]                      [이미지] │
│ [설명 1-2줄]                [80x80] │
│ [도메인]                            │
└─────────────────────────────────────┘
```

### 2️⃣ ESC 키로 모달 닫기
```javascript
// PostDetailModal.jsx
useEffect(() => {
  const handleKeyDown = (e) => {
    if (e.key === 'Escape' && isOpen) {
      onClose()
    }
  }

  window.addEventListener('keydown', handleKeyDown)
  return () => window.removeEventListener('keydown', handleKeyDown)
}, [isOpen, onClose])
```

**키보드 UX 개선**
- ESC 키 → 모달 즉시 닫기
- 마우스 없이 키보드만으로 탐색 가능
- 웹 표준 UX 패턴 적용

## 작동 방식

### Before (일반 링크)
```
추천 사이트: https://github.com/user/repo
              ↑ 파란 밑줄 텍스트
```
→ 클릭해야만 내용 확인 가능

### After (미리보기 카드)
```
추천 사이트:
┌──────────────────────────────┐
│ GitHub - user/repo    [icon] │
│ 프로젝트 설명...             │
│ github.com                   │
└──────────────────────────────┘
```
→ 클릭 전에도 제목, 설명, 이미지 확인 가능!

## 링크 미리보기 특징

✅ **자동 감지**: http:// 또는 https://로 시작하는 모든 URL
✅ **Open Graph 지원**: og:title, og:description, og:image 자동 추출
✅ **낮은 직사각형 디자인**: 공간 효율적, 모바일 최적화
✅ **썸네일 표시**: 오른쪽에 이미지 80x80px (모바일), 96x96px (PC)
✅ **Graceful Degradation**: 로딩 실패 시 일반 링크로 fallback
✅ **유튜브 우선**: 유튜브 URL은 여전히 플레이어로 표시
✅ **새 탭 열기**: target="_blank" 유지
✅ **반응형**: 모바일/PC 모두 최적화

## ESC 키 기능

✅ **웹 표준 UX**: 모달 닫기는 ESC
✅ **키보드 탐색**: 마우스 없이도 사용 가능
✅ **조건부 작동**: 모달이 열린 상태일 때만 작동
✅ **이벤트 정리**: useEffect cleanup으로 메모리 누수 방지

## 사용된 기술

### 링크 미리보기
- **Microlink API**: Open Graph 메타데이터 fetch (무료: 50 req/day)
- **React Hooks**: useState, useEffect로 비동기 데이터 관리
- **Error Handling**: try-catch, onError로 이미지 실패 처리
- **CSS Grid/Flexbox**: 카드 레이아웃 구성
- **Tailwind CSS**: line-clamp-1, line-clamp-2로 텍스트 truncate
- **URL API**: `new URL(url).hostname`으로 도메인 추출

### ESC 키
- **Keyboard Events**: window.addEventListener('keydown')
- **Event Cleanup**: removeEventListener로 메모리 관리
- **Conditional Rendering**: isOpen 상태 확인

## API 사용량 관리

### Microlink API 제한
- **무료 티어**: 50 requests/day per IP
- **충분한 이유**:
  - 친구들끼리 사용하는 비공개 게시판
  - 하루 50개 이상 링크 올리기 어려움
  - 캐싱으로 같은 URL 재사용 시 API 호출 안 함 (브라우저 캐시)

### 향후 확장 가능성
- 유료 플랜 ($9/월): 15,000 requests/month
- 자체 서버 구축: Supabase Edge Functions로 직접 fetch
- 대안 API: linkpreview.net, urlmeta.org 등

## 효과

### 링크 미리보기
✅ **정보 제공**: 클릭 전 내용 미리 확인
✅ **신뢰성**: 이미지와 설명으로 안전성 판단
✅ **편의성**: 어떤 사이트인지 한눈에 파악
✅ **전문성**: 카톡, 디스코드처럼 링크 카드 표시

### ESC 키
✅ **빠른 탐색**: 키보드로 모달 즉시 닫기
✅ **웹 표준**: 익숙한 UX 패턴
✅ **접근성**: 마우스 없이도 사용 가능

## 실제 사용 예시

### 게시물 작성
```
오늘 발견한 좋은 글!
https://github.com/user/awesome-project

이것도 추천
https://dev.to/article/react-tips
```

### 표시 결과
```
오늘 발견한 좋은 글!
┌──────────────────────────────────┐
│ awesome-project          [icon]  │
│ A collection of...               │
│ github.com                       │
└──────────────────────────────────┘

이것도 추천
┌──────────────────────────────────┐
│ React Tips and Tricks    [img]   │
│ Learn advanced React...          │
│ dev.to                           │
└──────────────────────────────────┘
```

### 키보드 탐색
1. 게시물 클릭 → 모달 열림
2. 내용 읽기
3. **ESC 키** → 모달 닫힘
4. 다음 게시물로 이동

→ 마우스 없이 빠른 탐색 가능!

## 기술적 개선사항

### PostContent.jsx
```javascript
// Before: 일반 링크
<a href={url} className="text-blue-600 underline">
  {url}
</a>

// After: 미리보기 카드
<LinkPreview url={url} />
```

### LinkPreview.jsx
```javascript
// 3가지 상태 처리
1. loading: 일반 링크 표시
2. error: 일반 링크로 fallback
3. success: 미리보기 카드 표시

// 이미지 로드 실패 처리
<img
  onError={(e) => {
    e.target.style.display = 'none'
  }}
/>
```

## 한계점 및 향후 개선

### 현재 한계
- API 무료 티어: 하루 50개 제한
- 첫 로딩 시간: 네트워크 요청 필요
- CORS 제약: 직접 fetch 불가능 (Microlink 의존)

### 향후 개선 방안
1. **캐싱 강화**: React Query로 중복 fetch 방지
2. **Supabase Edge Functions**: 자체 프록시 서버 구축
3. **Lazy Loading**: viewport에 들어올 때만 fetch
4. **Prefetching**: 게시물 목록 로드 시 미리 fetch

→ 지금은 무료 API로 충분하지만, 확장 가능성 확보!
